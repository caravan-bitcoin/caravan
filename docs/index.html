<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>caravan</title><meta name="description" content="Documentation for caravan"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">caravan</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>caravan</h1></div><div class="tsd-panel tsd-typography"><p align="center">
  <img src="media/caravan-logo-transparent.png" />
</p>
<h1 id="caravan-monorepo" class="tsd-anchor-link">Caravan Monorepo<a href="#caravan-monorepo" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://github.com/caravan-bitcoin/caravan/pulls"><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square" alt="PRs Welcome"></a>
<img src="https://github.com/caravan-bitcoin/caravan/actions/workflows/ci.yml/badge.svg" alt="Build Status">
<a href="https://caravan-coordinator.vercel.app"><img src="https://therealsujitk-vercel-badge.vercel.app/?app=caravan-coordinator" alt="Vercel Deploy"></a>
<a href="https://caravan-bitcoin.github.io/caravan/#/"><img src="https://github.com/caravan-bitcoin/caravan/actions/workflows/deploy.yml/badge.svg" alt="Hosted Coordinator"></a>
<img src="https://github.com/caravan-bitcoin/caravan/actions/workflows/release.yml/badge.svg" alt="Package Publication">
<a href="https://hub.docker.com/r/caravanbitcoin/coordinator"><img src="https://img.shields.io/docker/pulls/caravanbitcoin/coordinator?logo=docker" alt="Pulls from DockerHub"></a></p>
<h2 id="introduction" class="tsd-anchor-link">Introduction<a href="#introduction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is a monorepo project for the Caravan FOSS ecosystem, built with
<a href="https://turbo.build/repo/docs">Turborepo</a>.</p>
<p>There are two primary directories for managing projects:</p>
<ul>
<li>apps</li>
<li>packages</li>
</ul>
<p>The main app is a webapp forked from the original <a href="https://github.com/unchained-capital/caravan">Caravan project</a>
which is being re-branded as the &quot;Caravan Coordinator&quot;. The goal is to have many
more applications built within this ecosystem that can live under the caravan/apps directory.</p>
<p><code>caravan/packages</code> is where the utility libraries live. Their foundation are forked versions of the <a href="https://github.com/unchained-capital/unchained-bitcoin"><code>unchained-bitcoin</code></a>
and <a href="https://github.com/unchained-capital/unchained-wallets"><code>unchained-wallets</code></a>
projects. These are being re-branded for legacy support
as <code>@caravan/bitcoin</code> and <code>@caravan/wallets</code> but moving forward
the expectation is that they will be split up as well. For
example the <code>psbt</code> module in <code>@caravan/bitcoin</code> will become
<code>@caravan/psbt</code>.</p>
<h2 id="goals" class="tsd-anchor-link">Goals<a href="#goals" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>There are a few goals for this new conception of the &quot;Caravan&quot;
project.</p>
<ul>
<li>Caravan is a familiar and trusted name in the javascript FOSS bitcoin ecosystem. Having the utility libraries that the coordinator relies on be under the same umbrella makes that relationship clearer</li>
<li>Scoping libraries will help protect from supply chain attacks</li>
<li>Moving the project into a monorepo will help improve and streamline the developer and deployment experience. Being able to test changes to the libraries in the coordinator immediately will create a faster feedback loop for development.</li>
<li>Having tightly scoped libraries will make code easier and safer to audit and build out.</li>
<li>Having a unified set of developer tooling (linting rules, deployment automation, etc.) also improves developer QoL and code reliability.</li>
</ul>
<h2 id="developers" class="tsd-anchor-link">Developers<a href="#developers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The monorepo setup should make it easier for developers to test their changes
in a more realistic environment, especially when making changes to libraries
that are dependencies of the coordinator.</p>
<p>In the caravan monorepo we use <code>changesets</code> to manage versioning and releases.
A changeset will be <em>required</em> for PRs to be merged. Read below to learn more.</p>
<h3 id="changesets" class="tsd-anchor-link">Changesets<a href="#changesets" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><h4 id="quickstart" class="tsd-anchor-link">Quickstart<a href="#quickstart" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Any PR to caravan that introduces a functional change requires a changeset be submitted with it.</p>
<p>Simply run the following command and follow the cli instructions:</p>
<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1"> </span><span class="hl-0">changeset</span>
</code><button>Copy</button></pre>

<p>Learn about <a href="https://docs.npmjs.com/about-semantic-versioning">semantic versioning</a> if you
are unsure whether your changes qualify as a patch, minor, or major change.</p>
<p>Pull Requests are checked for changesets by the <a href="https://github.com/apps/changeset-bot">changeset-bot</a>.</p>
<p><a href="https://github.com/changesets/action">Changesets GitHub Actions</a> are run to create a version PR
and publish on merge.</p>
<h4 id="about-changesets" class="tsd-anchor-link">About Changesets<a href="#about-changesets" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This is the <a href="https://turbo.build/repo/docs/handbook/publishing-packages/versioning-and-publishing">recommended way by Turborepo</a>
to handle changelogs, versioning, and releases.
It's designed first as a manual process, so by default it won't &quot;yell&quot; at you to do
things correctly. This adds more flexibility over something like commitlint which
can have a steep learning curve and frustrating for new contributors.</p>
<p>Read the documentation for adding a changeset <a href="https://github.com/changesets/changesets/blob/main/docs/adding-a-changeset.md">here</a></p>
<p>And another good resource for what the workflow should look like <a href="https://blog.logrocket.com/version-management-changesets/">here</a></p>
<h4 id="what-is-a-changeset" class="tsd-anchor-link">What is a changeset?<a href="#what-is-a-changeset" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><blockquote>
<p>A changeset is a Markdown file with YAML front matter. The contents of the Markdown is the change summary which will be written to the changelog and the YAML front matter describes what packages have changed and what semver bump types they should be</p>
</blockquote>
<p>(source)[<a href="https://github.com/changesets/changesets/blob/main/docs/detailed-explanation.md#the-solution-changesets">https://github.com/changesets/changesets/blob/main/docs/detailed-explanation.md#the-solution-changesets</a>]</p>
<h4 id="relevant-tooling" class="tsd-anchor-link">Relevant tooling<a href="#relevant-tooling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>CLI generation of new changesets</li>
<li>Automated consumption of changesets to do versioning</li>
<li>Detection + surfacing of changesets in PRs</li>
</ul>
<p><a href="https://github.com/changesets/changesets/blob/main/docs/automating-changesets.md">Automating Changesets</a></p>
<h2 id="getting-started" class="tsd-anchor-link">Getting started<a href="#getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="quickstart-1" class="tsd-anchor-link">Quickstart<a href="#quickstart-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Clone the repo, install all dependencies, and run dev instances of
everything.</p>
<p>(Checkout the README for caravan/descriptors to make sure you can build the wasm dependencies.)</p>
<pre><code class="shell"><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-3">turbo</span><span class="hl-1"> </span><span class="hl-4">--global</span><br/><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">git</span><span class="hl-1"> </span><span class="hl-3">clone</span><span class="hl-1"> </span><span class="hl-3">https://github.com/caravan-bitcoin/caravan.git</span><br/><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">cd</span><span class="hl-1"> </span><span class="hl-3">caravan</span><br/><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><br/><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">turbo</span><span class="hl-1"> </span><span class="hl-3">run</span><span class="hl-1"> </span><span class="hl-3">dev</span><span class="hl-1"> </span><span class="hl-5"># or `npm run dev`</span>
</code><button type="button">Copy</button></pre>

<h4 id="whats-happening" class="tsd-anchor-link">What's happening?<a href="#whats-happening" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The turbo.json file is the main config for the monorepo. You can read
about running tasks in Turborepo <a href="https://turbo.build/repo/docs/core-concepts/monorepos/running-tasks#turborepo-can-multitask">here</a>.</p>
<p>Note:</p>
<blockquote>
<p>After you've declared a task in turbo.json, it's up to you to implement it in your package.json manifests. You can add scripts all at once, or one workspace at a time. Turborepo will gracefully skip workspaces that don't include the task in their respective package.json manifest.</p>
</blockquote>
<p>The main scripts to be run are defined in this config file:
<code>build</code>, <code>lint</code>, <code>test</code>, and <code>dev</code>.</p>
<h2 id="development" class="tsd-anchor-link">Development<a href="#development" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>One of the main benefits of a monorepo for this type of project is
being able to easily work with multiple dependencies you're developing
at the same time. Note for example that in the <code>caravan/coordinator</code>'s
package.json, the dependencies from the monorepo are referenced with
a simple <code>*</code> rather than a version or repository location.</p>
<h3 id="running-commands" class="tsd-anchor-link">Running commands<a href="#running-commands" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="shell"><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">turbo</span><span class="hl-1"> </span><span class="hl-3">run</span><span class="hl-1"> </span><span class="hl-3">test:debug</span><span class="hl-1"> </span><span class="hl-4">--scope=@caravan/bitcoin</span><span class="hl-1"> </span><span class="hl-4">--no-deps</span><span class="hl-1"> </span><span class="hl-4">--no-cache</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>scope says you want to just run the command for that package (<code>@caravan/bitcoin</code>)</li>
<li><code>--no-deps</code> is optional and says to skip any related packages. Without this, everything else that depends on <code>@caravan/bitcoin</code> will also be run</li>
<li><code>--no-cache</code> also optional and self-explanatory. Usually not necessary but turborepo does a lot of cacheing so good to be aware of.</li>
</ul>
<h3 id="dependencies" class="tsd-anchor-link">Dependencies<a href="#dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>--no-deps</code> option highlights a lot of the benefits of the monorepo. If you make a change in one library,
anything else that relies on it should be tested to make sure they're not broken too.
If you want to break this coupling, a published package version can be referenced instead of
using <code>*</code> (this is not recommended however).</p>
<h4 id="note-about-internal-packages" class="tsd-anchor-link">Note about internal packages<a href="#note-about-internal-packages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Sometimes it makes sense to move code you want to share between packages into an internal package.
In fact this is <a href="https://turbo.build/repo/docs/crafting-your-repository/creating-an-internal-package#best-practices-for-internal-packages">recommended by Turborepo</a>.</p>
<blockquote>
<p>When you're creating Internal Packages, it's recommended to create packages that have a single &quot;purpose&quot;.</p>
</blockquote>
<p>Internal packages should be added to the <code>devDependencies</code> list of the packages/apps that depend on them.
This is because the bundlers (tsup by default in caravan) won't include <code>dependencies</code> into the bundle
and then when the package is attempted to be installed by external downstream projects it will try
and find the internal dependency in a remote registry (which will fail). By including it in the
devDependency:</p>
<ul>
<li>the dependency graph will be correct</li>
<li>the bundler will build it in with the final package</li>
<li>other projects won't try and install the internal dependency</li>
</ul>
<p>@caravan/multisig is an example of such a package that is depended on by other packages
like @caravan/psbt and @caravan/wallets.</p>
<h3 id="adding-a-new-package" class="tsd-anchor-link">Adding a new package<a href="#adding-a-new-package" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>NOTE: Turborepo provides <a href="https://turbo.build/repo/docs/core-concepts/monorepos/code-generation">code generator capability</a>
for bootstrapping a new project. You can run <code>turbo gen</code> or <code>npm run gen</code>
from the root of the project and you will be prompted through some
bootstrapping questions.</p>
<p>You can keep reading this section to understand what's being built out
and write a fully functioning package yourself.</p>
<h4 id="manually-adding-a-new-package" class="tsd-anchor-link">Manually adding a new package<a href="#manually-adding-a-new-package" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><code>packages/caravan-psbt</code> is a good starting point for a simple package.</p>
<p>Let's make a package <code>@caravan/clients</code>. This is code that's being added
to caravan in <a href="https://github.com/unchained-capital/caravan/pull/365">this PR</a>
but would be a good candidate for a standalone package.</p>
<ol>
<li>Initialize the project directory</li>
</ol>
<ul>
<li><code>packages/caravan-clients</code></li>
<li><code>cd packages/caravan-clients &amp;&amp; npm init</code></li>
</ul>
<pre><code class="shell"><span class="hl-2">package</span><span class="hl-1"> </span><span class="hl-3">name:</span><span class="hl-1"> </span><span class="hl-3">@caravan/clients</span><br/><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-6">0.0.0</span><br/><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-3">...</span><br/><span class="hl-2">entry</span><span class="hl-1"> </span><span class="hl-3">point:</span><span class="hl-1"> </span><span class="hl-3">./dist/index.js</span><br/><span class="hl-2">test</span><span class="hl-1"> </span><span class="hl-3">command:</span><span class="hl-1"> </span><span class="hl-3">jest</span><span class="hl-1"> </span><span class="hl-3">src</span><br/><span class="hl-2">keywords:</span><span class="hl-1"> </span><span class="hl-3">...</span><br/><span class="hl-2">author:</span><span class="hl-1"> </span><span class="hl-3">...</span><br/><span class="hl-2">license:</span><span class="hl-1"> </span><span class="hl-3">MIT</span>
</code><button type="button">Copy</button></pre>

<p>This will initialize a package.json for you. But we want to add a few more fields for a final version:</p>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;@caravan/clients&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;version&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;0.0.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;description&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;...&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;main&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.js&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;types&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.d.ts&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;module&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.mjs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;exports&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;.&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-7">&quot;require&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.js&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">&quot;import&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.mjs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">&quot;types&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;./dist/index.d.ts&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;scripts&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;build&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;tsup src/index.ts --format cjs,esm --dts&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;dev&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;npm run build -- --watch&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;test&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;jest src&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;test:watch&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;jest --watch src&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;keywords&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;bitcoin&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;client&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;mempool&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;blockstream&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;blockchain&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;author&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;Buck Perley&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;license&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;MIT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;engines&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;node&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;&gt;=16&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;devDependencies&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;@caravan/eslint-config&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;*&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;tsconfig&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;*&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Install some more dependencies (from package dir):</li>
</ul>
<pre><code class="shell"><span class="hl-2">$</span><span class="hl-1"> </span><span class="hl-3">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-4">--save-dev</span><span class="hl-1"> </span><span class="hl-3">typescript</span><span class="hl-1"> </span><span class="hl-3">tsup</span><span class="hl-1"> </span><span class="hl-3">eslint</span><span class="hl-1"> </span><span class="hl-3">jest</span><span class="hl-1"> </span><span class="hl-3">ts-jest</span>
</code><button type="button">Copy</button></pre>

<p>(alternatively can use the <code>--scope</code> arg to target the package from the root)</p>
<ul>
<li>Add configs: <code>eslintrc.js</code>, <code>tsconfig.json</code>, <code>jest.config.js</code>:</li>
</ul>
<pre><code class="javascript"><span class="hl-5">// .eslintrc.js</span><br/><span class="hl-8">module</span><span class="hl-1">.</span><span class="hl-8">exports</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">root:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">extends:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;@caravan/eslint-config/library.js&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">parser:</span><span class="hl-1"> </span><span class="hl-3">&quot;@typescript-eslint/parser&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">parserOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">project:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<pre><code class="json"><span class="hl-5">// tsconfig.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;extends&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;@caravan/typescript-config/base.json&quot;</span><br/><span class="hl-1">}</span><br/>
</code><button type="button">Copy</button></pre>

<pre><code class="javascript"><span class="hl-5">// jest.config.js</span><br/><span class="hl-8">module</span><span class="hl-1">.</span><span class="hl-8">exports</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">preset:</span><span class="hl-1"> </span><span class="hl-3">&quot;ts-jest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">testEnvironment:</span><span class="hl-1"> </span><span class="hl-3">&quot;node&quot;</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>create a <code>src/</code> directory and add the entrypoint <code>index.ts</code> file</li>
<li>add our module file(s) (e.g. <code>src/clients.ts</code>) and test file(s) (e.g. <code>src/clients.test.ts</code>)
<ul>
<li>NOTE: when these files were copied over, they came from caravan when not all files were converted to typescript. A <code>transform</code> field needed to be added to the jest config as well as <code>babel-jest</code> package to handle js transformations for those older files.</li>
</ul>
</li>
<li>You should now be able to run <code>turbo run test --scope=@caravan/clients</code> and <code>turbo run build --scope=@caravan/clients</code> to test and build</li>
<li>To start using this in another package, say <code>caravan-coordinator</code> simply add it to the package.json with a <code>*</code>:</li>
</ul>
<pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-7">&quot;dependencies&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-9">...,</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;@caravan/clients&quot;</span><span class="hl-1">: </span><span class="hl-3">&quot;*&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">...,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Run the development server with turbo: <code>turbo run dev</code></li>
<li>Add to <code>ClientPicker/index.tsx</code> (as an example):</li>
</ul>
<pre><code class="typescript"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-0">BlockchainClient</span><span class="hl-1">, </span><span class="hl-0">ClientType</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@caravan/clients&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">...</span><br/><span class="hl-1">  </span><span class="hl-5">// add this function to the component and put it to use!</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-2">getFees</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-11">blockchainClient</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-2">BlockchainClient</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-0">ClientType</span><span class="hl-1">.</span><span class="hl-11">MEMPOOL</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">client</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">network</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-0">blockchainClient</span><span class="hl-1">.</span><span class="hl-2">getFeeEstimate</span><span class="hl-1">(</span><span class="hl-6">3</span><span class="hl-1">);</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">...</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Note that now not only if you make a change to <code>caravan/coordinator</code> the changes will be reflected almost instantly in the app, but you can also make a change to the dependencies and everything will rebuild (technically turborepo only rebuilds what is necessary, caching the rest). Add a console.log to the <code>getFeeEstimate</code> in the <code>BlockchainClient</code> app and see for yourself!</li>
</ul>
<h2 id="troubleshooting" class="tsd-anchor-link">Troubleshooting<a href="#troubleshooting" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>you might see an error &quot;The request '...' failed to resolve only because it was resolved as fully specified&quot;
Webpack has an <a href="https://github.com/webpack/webpack/issues/11467#issuecomment-691873586">issue</a> by default
resolving the built module package if the extension is not specified. You can fix this by adding the following
rule to your webpack config (module.rules array):</li>
</ul>
<pre><code class="javascript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-12">test</span><span class="hl-1">:</span><span class="hl-13"> /</span><span class="hl-14">\.</span><span class="hl-13">m</span><span class="hl-15">?</span><span class="hl-13">js/</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-12">resolve</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-12">fullySpecified</span><span class="hl-1">: </span><span class="hl-4">false</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">},</span>
</code><button type="button">Copy</button></pre>

<p>This will usually happen if a package was written trying to do a direct import of a file from a dependency and not
specifying the extension, for example:</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-0">reverseBuffer</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-3">&quot;bitcoinjs-lib/src/bufferutils&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>instead of</p>
<pre><code class="ts"><span class="hl-10">import</span><span class="hl-1"> { </span><span class="hl-0">reverseBuffer</span><span class="hl-1"> } </span><span class="hl-10">from</span><span class="hl-1"> </span><span class="hl-3">&quot;bitcoinjs-lib/src/bufferutils.js&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#caravan-monorepo"><span>Caravan <wbr/>Monorepo</span></a><ul><li><a href="#introduction"><span>Introduction</span></a></li><li><a href="#goals"><span>Goals</span></a></li><li><a href="#developers"><span>Developers</span></a></li><li><ul><li><a href="#changesets"><span>Changesets</span></a></li><li><ul><li><a href="#quickstart"><span>Quickstart</span></a></li><li><a href="#about-changesets"><span>About <wbr/>Changesets</span></a></li><li><a href="#what-is-a-changeset"><span>What is a changeset?</span></a></li><li><a href="#relevant-tooling"><span>Relevant tooling</span></a></li></ul></li></ul></li><li><a href="#getting-started"><span>Getting started</span></a></li><li><ul><li><a href="#quickstart-1"><span>Quickstart</span></a></li><li><ul><li><a href="#whats-happening"><span>What&#39;s happening?</span></a></li></ul></li></ul></li><li><a href="#development"><span>Development</span></a></li><li><ul><li><a href="#running-commands"><span>Running commands</span></a></li><li><a href="#dependencies"><span>Dependencies</span></a></li><li><ul><li><a href="#note-about-internal-packages"><span>Note about internal packages</span></a></li></ul></li><li><a href="#adding-a-new-package"><span>Adding a new package</span></a></li><li><ul><li><a href="#manually-adding-a-new-package"><span>Manually adding a new package</span></a></li></ul></li></ul></li><li><a href="#troubleshooting"><span>Troubleshooting</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">caravan</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
